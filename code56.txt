# PROG-5 (data manip,dplyr,group)

library(dplyr)
library(nycflights13)
library(zoo)
library(ggplot2)

data("starwars")
print(starwars)

starwars_filtered = starwars %>%
  select(name, height, species, mass) %>%
  filter(!is.na(species) & !is.na(height) & height > 100) %>%
  arrange(desc(height))

print(starwars_filtered)

ggplot(starwars_filtered, aes(x = name, y = height, fill = species)) +
  geom_bar(stat = "identity") +
  coord_flip() +
  labs(title = "Height of Star Wars Characters", x = "Character", y = "Height (cm)")

species_summary = starwars %>%
  group_by(species) %>%
  summarise(
    avg_height = mean(height, na.rm = TRUE),
    avg_mass = mean(mass, na.rm = TRUE),
    count = n()
  ) %>%
  arrange(desc(count))

print(species_summary)

ggplot(species_summary, aes(x = species, y = avg_height, fill = species)) +
  geom_bar(stat = "identity") +
  coord_flip() +
  labs(title = "Average Height by Species", x = "Species", y = "Average Height (cm)")

starwars_classified = starwars %>%
  mutate(height_category = ifelse(height > 180, "TALL", "SHORT"))

print(starwars_classified)

ggplot(starwars_classified, aes(x = height_category, fill = height_category)) +
  geom_bar(stat = "count") +
  labs(title = "Distribution of Height Categories", x = "Height Category", y = "Count")

data("flights")
data("airlines")

flights_inner_join = flights %>%
  inner_join(airlines, by = "carrier")

flights_outer_join = flights %>%
  full_join(airlines, by = "carrier")

head(flights_inner_join)
head(flights_outer_join)

flights_rolling = flights %>%
  arrange(year, month, day) %>%
  mutate(
    arr_delay = ifelse(is.na(arr_delay), 0, arr_delay),
    rolling_avg_delay = rollmean(arr_delay, 5, fill = NA),
    cumulative_delay = cumsum(arr_delay)
  )

head(flights_rolling)

ggplot(flights_rolling, aes(x = day)) +
  geom_line(aes(y = rolling_avg_delay, color = "blue")) +
  geom_line(aes(y = cumulative_delay / 1000, color = "red")) +
  labs(title = "Rolling Average and Cumulative Delay of Flights",
       x = "Day of the Month", y = "Delay (minutes)") 




# PROG-6 (Data viz ggplot2)



library(ggplot2)
library(dbplyr)
library(reshape2)
library(ggcorrplot)

data("mpg")
head(mpg)

ggplot(mpg,aes(x = displ,y = hwy,color = class)) +
  geom_point(size=3,alpha = 0.7) +
  geom_smooth(method = "lm", se = TRUE, linetype = "dashed", linewidth = 1, color = "black") +
  labs(
    title = "Scatter Plot of Engine Displacement vs Highway MPG wit Regression Line",
    x = "Engine Displacement (L)",
    y = "Highway Miles per Gallon",
    color = "Vehicle Class"
  ) +
  theme_bw()

ggplot(mpg,aes(x = displ,y = hwy)) +
  geom_point(color = "green") +
  facet_wrap(facets = ~class, ncol = 2) +
  labs(
    title = "Faceted Scatter Plot by Vehicle Class",
    x = "Engine Displacement",
    y = "Highway miles per gallon"
  )

data("diamonds")
print(diamonds)

cor_matrix <- cor(diamonds[, sapply(diamonds, is.numeric)], use = "complete.obs")
print(cor_matrix)

cor_data <- melt(cor_matrix)
print(cor_data)

ggcorrplot(
  cor_matrix,
  title = "HeatMap of correlation matrix",
  ggtheme = theme_bw(),
  method = "circle"
)

ggplot(mpg, aes(x = displ, y = hwy, color = class)) +
  geom_point(size = 3) +
  theme_classic() +
  scale_color_brewer(palette = "Set2") +
  labs(
    title = "Customized Scatter Plot with Aesthetic Enhancements",
    x = "Engine Displacement (L)",
    y = "Highway Miles per Gallon",
    color = "Class"
  )

annotated_plot <- ggplot(mpg, aes(x = displ, y = hwy, color = "class")) +
  geom_point(size = 2) +
  annotate("text", x = 3, y = 40, label = "High Efficiency Zone", color = "black", size = 5) +
  annotate("rect", xmin = 2, xmax = 4, ymin = 30, ymax = 45, fill = "yellow", color = "orange", alpha = 0.31) +
  labs(
    title = "Annotated Scatter Plot with Highlighted Zone",
    x = "Engine Displacement (L)",
    y = "Highway Miles per Gallon"
  ) +
  theme_classic()

annotated_plot

ggsave("annotatedplt.png", annotated_plot)
